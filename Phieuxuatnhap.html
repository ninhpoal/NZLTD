<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <title>Phiếu kho nz</title>
    <meta name="csrf-token" content="MHMXdIG4tBlzbq7sMs8y0wjq43Dtbf8PaMgnKDS3">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="shortcut icon" href="Logo N có bóng/Logo N.png" type="image/x-icon">
    <!-- jQuery library -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />

    <style>
        body {
            background: rgb(204, 204, 204);
            font-family: "Times New Roman", Times, serif;
        }

        .fixed-button {
            position: fixed;
            bottom: 20px;
            /* Điều chỉnh vị trí từ dưới lên, bạn có thể thay đổi giá trị này */
            right: 20px;
            /* Điều chỉnh vị trí từ phải sang, bạn có thể thay đổi giá trị này */
            width: 100%;
            max-width: 200px;
            /* Điều chỉnh chiều rộng tối đa của button */
        }

        page {
            background: white;
            display: block;
            margin: 0 auto;
            margin-bottom: 0.5cm;
            box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
        }

        page[size="A4"][layout="landscape"] {
            width: 29.7cm;
            height: 100%;

        }




        @media print {

            body,
            #content {
                margin: 0;
                box-shadow: 0;
                font-size: 18px !important;
            }

            h5 {
                font-size: 24px
            }

            .big-title {
                font-size: 18px !important;
            }

            .total-pay {
                font-size: 15px !important;
            }

            @page {
                size: auto;
            }

            #content-split {
                margin-top: 40px;
                position: absolute;
                top: 50%;
                width: 920px;
            }

            .height_hr {
                border-top: 3px dashed black;
                width: 100%;
                position: absolute;
                top: 49%;
            }

            #content-split .div-logo {
                position: relative;
                top: -10px;
                left: 10px;
            }
        }

        #content {
            font-size: 13.5px;

        }


        .center {
            text-align: center;
        }

        .right {
            text-align: right;
        }

        .bold {
            font-weight: bold;
        }

        .big-title {
            font-size: 15px;
        }

        #fixed-panel,
        #fixed-show-user,
        #fixed-show-reason {
            font-size: 13px;
        }


        #content {
            padding: 40px 40px;
        }

        #select-setup-print {
            position: relative;
            top: -2px;
            background-color: #17a2b8;
            color: white;
        }

        #setup-print {
            position: fixed;
            top: 480px;
            left: 30px;
            width: 150px;
            height: 54px;
            background-color: #ffffff;
            padding: 10px;
            border-radius: 5px;
            /*font-size: 13px;*/
            box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
        }


        .heigth-90px {
            height: 90px !important;
        }

        #page {
            margin-top: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .center-content {
            text-align: center;
            vertical-align: middle;
        }

        .big-title {
            text-transform: uppercase;
            font-weight: bold;
            /*font-size: 15px;*/
            padding-bottom: 5px;
        }

        hr {
            margin-top: 5px;
            margin-bottom: 5px;
        }

        .bold {
            font-weight: bold;
        }

        .table-center th {
            text-align: center;
            vertical-align: middle;
        }

        .info_student {
            margin-top: 10px;
            text-align: justify;
        }

        .info_contract {
            margin-bottom: 5px !important
        }

        .preserve-format {
            white-space: pre-wrap;
            word-wrap: break-word;
        }


        @media only screen and (max-width: 1024px) {
            #fixed-panel {
                display: none !important;
            }

            #list_option_print {
                display: none !important;
            }
        }
    </style>

</head>

<body>
    <button onclick="print()" class="btn btn-info fixed-button" style="width: 100%"><i class="fa fa-print"></i> <span
            class="language_print"></span></button>
    <page size="A4" id="page" layout="landscape">
        <div id="content">
            <div class="content_page1">
                <table style="width: 100%;">
                    <tr>
                        <th rowspan="4"> <img src="Logo N có bóng/Logo N.png" style="width: 100px;"></th>
                        <th rowspan="4" class="center">
                            <h5 class=" bold">CÔNG TY TNHH THƯƠNG MẠI VÀ DỊCH VỤ NZ </h5>

                        </th>

                    </tr>

                </table>


                <div style="clear: both"></div>

                <br>
                <p style="text-align: right;"><i>Hồ Chí Minh, Ngày <span id="ngay"></span>, Tháng <span
                            id="thang"></span>, Năm <span id="nam"></span> </i></p>
                <h4 style="text-align: center;" class="bold">Phiếu <span id="loaiphieu"> </span></h4>

                <div style="text-align: center;"> <i>Số phiếu<span id="id"></span></i><br></div>



                <br>
                <table style="width: 100%;">
                    <tr>
                        <th>Mã dự án: </th>
                        <td> <span id="mda"></span></td>
                        <th>Thủ kho: </th>
                        <td> <span id="thukho"></span></td>
                    </tr>
                    <tr>
                        <th>Từ kho: </th>
                        <td> <span id="tukho"></span></td>

                        <th>Đến kho: </th>
                        <td> <span id="denkho"></span></td>

                    </tr>
                    <tr>
                        <th>Trạng thái phiếu: </th>
                        <td> <span id="trangthai"></span></td>
                        <th>Thời gian đề xuất: </th>
                        <td> <span id="ghichuphieu"></span></td>

                    </tr>
                </table>
                <br>


                <table class="table table-bordered">
                    <thead class="center-content">

                        <tr>
                            <th>STT</th>
                            <th>Mã hàng</th>
                            <th>Tên thiết bị và cấu hình</th>
                            <th>Đơn vị tính</th>
                            <th>Số lượng</th>
                            <th>Mã cáp</th>
                            <th>Ghi chú</th>

                        </tr>
                    </thead>
                    <tbody id="orderDetailsBody">
                        <!-- Dữ liệu sẽ được điền vào đây bằng JavaScript -->
                    </tbody>

                </table>
                <br>
                <table style="width: 100%;">
                    <tr class="center">

                        <th> Thử kho</th>

                        <th>Người nhận </th>

                    </tr>
                    <tr class="center">
                        <td><i> (Ký ghi rõ họ tên)</i> </td>
                        <td><i> (Ký ghi rõ họ tên)</i></td>

                    </tr>
                    >

                </table>

            </div>
        </div>
    </page>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/printThis/1.15.0/printThis.min.js"
        integrity="sha512-d5Jr3NflEZmFDdFHZtxeJtBzk0eB+kkRXWFQqEc1EKmolXjHm2IKCA7kTvXBNjIYzjXfD5XzIjaaErpkZHCkBg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.centeronline.edu.vn/js/customer.js" type="text/javascript"></script>

    <script>
        const APP_ID = '3519f9a9-390d-425c-b2af-4c76794ddd4a';
        const TABLE_NAME_XN_CAP = 'Xuất nhập FPT';
        const TABLE_NAME_CHI_TIET = 'Vât tư NX FPT';
        const API_KEY = 'V2-DxCTd-Nhf75-B243D-CQXD9-1ePO4-GCtq5-mHU1v-YHx0j';
        const API_BASE_URL = 'https://www.appsheet.com/api/v2/apps';
        // Đặt biến SOPHIEU ở phạm vi toàn cục
        let SOPHIEU = '';

        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            SOPHIEU = urlParams.get('SOPHIEU');
            if (SOPHIEU) {
                console.log('SOPHIEU from URL:', SOPHIEU);
                fetchAndPopulateData();
            } else {
                console.error('SOPHIEU not found in URL');
            }
        }

        function apiRequest(tableName, action, data) {
            const apiUrl = `${API_BASE_URL}/${APP_ID}/tables/${encodeURIComponent(tableName)}/Action`;
            return $.ajax({
                url: apiUrl,
                method: 'POST',
                headers: {
                    'ApplicationAccessKey': API_KEY,
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify({
                    Action: action,
                    Properties: {
                        Locale: 'vi-VN',
                        Timezone: 'Asia/Ho_Chi_Minh',
                        ...data.Properties // Spread any additional properties
                    },
                    Rows: data.Rows || []
                })
            }).fail(function (jqXHR, textStatus, errorThrown) {
                console.error('API request failed:', textStatus, errorThrown);
            });
        }

        function fetchData(tableName, sophieu) {
            return apiRequest(tableName, 'Find', {
                Properties: {
                    Selector: `Filter(${tableName}, [Mã phiếu] = "${sophieu}")`,
                },
                Rows: []
            });
        }
        // Function to populate the main form
        function populateMainForm(data) {
            console.log('Populating main form with data:', data);
            if (Array.isArray(data) && data.length > 0) {
                const row = data[0];
                $('#mda').text(row['MDA'] || '');
                $('#thukho').text(row['Thủ kho'] || '');
                $('#tukho').text(row['Từ'] || '');
                $('#denkho').text(row['Đến'] || '');
                $('#trangthai').text(row['Trạng thái'] || '');
                $('#ghichuphieu').text(row['Thời gian'] || '');
                $('#loaiphieu').text(row['Mục'] || '');

                // Set the current date
                const now = new Date();
                $('#ngay').text(now.getDate());
                $('#thang').text(now.getMonth() + 1);
                $('#nam').text(now.getFullYear());

                $('#id').text(SOPHIEU);
            } else {
                console.error('No data found for main form');
            }
        }

        function populateDetailsTable(data) {
            console.log('Populating details table with data:', data);
            const tbody = $('#orderDetailsBody');
            tbody.empty();

            if (Array.isArray(data) && data.length > 0) {
                data.forEach((row, index) => {
                    const tr = $('<tr>');
                    tr.append($('<td>').text(index + 1));
                    tr.append($('<td>').text(row['Mã hàng'] || ''));
                    tr.append($('<td>').text(row['Tên thiết bị và cấu hình'] || ''));
                    tr.append($('<td>').text(row['Đvt'] || ''));
                    tr.append($('<td>').text(row['Số lượng'] || ''));
                    tr.append($('<td>').text(row['Mã cáp'] || ''));
                    tr.append($('<td>').text(row['Ghi chú'] || ''));
                    tbody.append(tr);
                });
            } else {
                console.error('No data found for details table');
                tbody.append($('<tr>').append($('<td colspan="7">').text('Không có dữ liệu')));
            }
        }

        function fetchAndPopulateData() {
            console.log('Fetching data for SOPHIEU:', SOPHIEU);
            // Fetch main form data
            fetchData(TABLE_NAME_XN_CAP, SOPHIEU)
                .then(data => {
                    console.log('Main form data:', data);
                    populateMainForm(data);
                    // After populating main form, fetch details
                    return fetchData(TABLE_NAME_CHI_TIET, SOPHIEU);
                })
                .then(data => {
                    console.log('Details data:', data);
                    populateDetailsTable(data);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        // Ensure this function is called when the document is ready
        $(document).ready(function () {
            init();
        });


        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = String(date.getFullYear());
            return `${day}/${month}/${year}`;
        }

        function formatCurrency(value) {
            if (!value) return '';
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);
        }

        function print() {
            $('#content').printThis({
                debug: false,
                importCSS: true,
                importStyle: true,
                printContainer: true,
                pageTitle: "",
                removeInline: false,
                removeInlineSelector: "*",
                printDelay: 333,
                header: null,
                footer: null,
                base: false,
                formValues: true,
                canvas: false,
                removeScripts: false,
                copyTagClasses: false,
                beforePrintEvent: null,
                beforePrint: null,
                afterPrint: null
            });
        }



    </script>
</body>

</html>